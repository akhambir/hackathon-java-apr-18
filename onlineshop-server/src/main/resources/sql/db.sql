CREATE SCHEMA SHOP;

CREATE TABLE SHOP.USERS(
	ID BIGINT AUTO_INCREMENT NOT NULL,
	FIRST_NAME VARCHAR(50) NOT NULL,
	LAST_NAME VARCHAR(50) NOT NULL,
	EMAIL VARCHAR(100) UNIQUE NOT NULL,
	PASSWORD VARCHAR(100) NOT NULL,
	TOKEN VARCHAR(200) NOT NULL,
	CONSTRAINT PK_USERS PRIMARY KEY (ID)
);

CREATE TABLE SHOP.CATEGORIES(
	ID BIGINT AUTO_INCREMENT NOT NULL,
	CATEGORY_NAME VARCHAR(50) NOT NULL,
	DESCRIPTION VARCHAR(200) NOT NULL,
	CONSTRAINT PK_CATEGORIES PRIMARY KEY (ID)
);

CREATE TABLE SHOP.PRODUCTS(
	ID BIGINT AUTO_INCREMENT NOT NULL,
	PRODUCT_NAME VARCHAR(50) NOT NULL,
	PRICE DOUBLE NOT NULL,
	FK_CATEGORY_ID BIGINT NOT NULL,
	CONSTRAINT PK_PRODUCTS PRIMARY KEY (ID),
	CONSTRAINT FK_CATEGORY_ID FOREIGN KEY (FK_CATEGORY_ID)
	  REFERENCES SHOP.CATEGORIES(ID)
);

CREATE TABLE SHOP.ORDERS(
	ID BIGINT AUTO_INCREMENT NOT NULL,
	ORDER_TIME DATETIME NOT NULL,
	FK_PRODUCT_ID BIGINT NOT NULL,
	FK_PRODUCT_PRICE DOUBLE NOT NULL,
	NUMBER_OF_PRODUCTS BIGINT NOT NULL,
	CONSTRAINT PK_ORDER PRIMARY KEY (ID),
	CONSTRAINT FK_PRODUCTS_ID FOREIGN KEY (FK_PRODUCT_ID)
	  REFERENCES SHOP.PRODUCTS(ID),
	CONSTRAINT FK_PRODUCTS_PRICE FOREIGN KEY (FK_PRODUCT_PRICE)
	  REFERENCES SHOP.PRODUCTS(PRICE)
);

CREATE TABLE SHOP.USER_TO_ORDER(
	ID BIGINT AUTO_INCREMENT NOT NULL,
	FK_ORDER_ID BIGINT NOT NULL,
	FK_USER_ID BIGINT NOT NULL,
	CONSTRAINT PK_USER_TO_ORDER PRIMARY KEY (ID),
	CONSTRAINT FK_ORDERS_ID FOREIGN KEY (FK_ORDER_ID)
	  REFERENCES SHOP.ORDERS(ID),
	CONSTRAINT FK_USERS_ID FOREIGN KEY (FK_USER_ID)
	  REFERENCES SHOP.USERS(ID)
);

CREATE TABLE SHOP.ROLES (
  ID BIGINT PRIMARY KEY AUTO_INCREMENT,
  ROLE_NAME VARCHAR(15) NOT NULL
);

CREATE TABLE SHOP.USER_TO_ROLE (
  ID BIGINT PRIMARY KEY AUTO_INCREMENT,
  FK_USER_ID BIGINT NOT NULL,
  FK_ROLE_ID BIGINT NOT NULL,
    CONSTRAINT FK_UTR_TO_USERS FOREIGN KEY (FK_USER_ID)
            REFERENCES SHOP.USERS(ID),
    CONSTRAINT FK_UTR_TO_ROLES FOREIGN KEY (FK_ROLE_ID)
            REFERENCES SHOP.ROLES(ID)
);

CREATE TABLE SHOP.CART (
  CART_ID BIGINT NOT NULL,
    FOREIGN KEY(CART_ID) REFERENCES SHOP.USERS(ID)
);

CREATE TABLE SHOP.CART_TO_PRODUCTS (
  FK_CART_ID BIGINT NOT NULL,
    FOREIGN KEY (FK_CART_ID) REFERENCES SHOP.CART(CART_ID),
  FK_PRODUCT_ID BIGINT NOT NULL,
    FOREIGN KEY (FK_PRODUCT_ID) REFERENCES SHOP.PRODUCTS(ID)
);
